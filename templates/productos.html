<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Productos - Gustica</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" />
        </div>
        <nav>
            <a href="{{ url_for('inicio') }}">Inicio</a>
            <a href="{{ url_for('quienes') }}">Quiénes Somos</a>
            <a href="{{ url_for('productos') }}">Productos</a>
            <a href="{{ url_for('carrito') }}">🛒 Carrito</a>
        </nav>
    </header>

    <main>
        <!-- Sección Productos -->
        <section id="productos" class="productos">
            <h2>Nuestros Productos</h2>
            <div class="productos-grid">
                <!-- Producto ejemplo -->
                <div class="producto-card" data-nombre="Piña" data-precio="2.50" data-descripcion="Piña fresca congelada, lista para tu jugo o postre." data-imagen="{{ url_for('static', filename='piña.jpg') }}">
                    <img src="{{ url_for('static', filename='piña.jpg') }}" alt="Piña">
                    <h3>Piña</h3>
                    <p>$2.50</p>
                </div>

                <div class="producto-card" data-nombre="Mango" data-precio="3.00" data-descripcion="Mango dulce y fresco, ideal para smoothies y postres." data-imagen="{{ url_for('static', filename='mango.jpg') }}">
                    <img src="{{ url_for('static', filename='mango.jpg') }}" alt="Mango">
                    <h3>Mango</h3>
                    <p>$3.00</p>
                </div>

                <!-- Agrega más productos aquí -->
            </div>
        </section>

        <!-- Modal del producto -->
        <div id="modal-producto" class="modal">
            <div class="modal-content">
                <span class="cerrar">&times;</span>
                <img id="modal-imagen" src="" alt="Producto">
                <h3 id="modal-nombre"></h3>
                <p id="modal-descripcion"></p>
                <p>Precio unitario: $<span id="modal-precio"></span></p>
                <label for="cantidad">Cantidad:</label>
                <input type="number" id="cantidad" value="1" min="1">
                <p>Total: $<span id="modal-total"></span></p>
                <button id="agregar-carrito">Agregar al carrito</button>
            </div>
        </div>
    </main>

    {% include 'footer.html' %}

    <script>
    const modal = document.getElementById('modal-producto');
    const modalImagen = document.getElementById('modal-imagen');
    const modalNombre = document.getElementById('modal-nombre');
    const modalDescripcion = document.getElementById('modal-descripcion');
    const modalPrecio = document.getElementById('modal-precio');
    const modalTotal = document.getElementById('modal-total');
    const cantidadInput = document.getElementById('cantidad');
    const agregarBtn = document.getElementById('agregar-carrito');
    const cerrarBtn = document.querySelector('.cerrar');

    let precioUnitario = 0;

    // Abrir modal al hacer click en un producto
    document.querySelectorAll('.producto-card').forEach(card => {
        card.addEventListener('click', () => {
            modal.style.display = 'block';
            modalImagen.src = card.dataset.imagen;
            modalNombre.textContent = card.dataset.nombre;
            modalDescripcion.textContent = card.dataset.descripcion;
            modalPrecio.textContent = parseFloat(card.dataset.precio).toFixed(2);
            precioUnitario = parseFloat(card.dataset.precio);
            cantidadInput.value = 1;
            modalTotal.textContent = precioUnitario.toFixed(2);
        });
    });

    // Cerrar modal
    cerrarBtn.addEventListener('click', () => {
        modal.style.display = 'none';
    });

    // Calcular total según cantidad
    cantidadInput.addEventListener('input', () => {
        let cantidad = parseInt(cantidadInput.value);
        if (cantidad < 1) cantidad = 1;
        modalTotal.textContent = (precioUnitario * cantidad).toFixed(2);
    });

    // Función para agregar producto al carrito (localStorage)
    agregarBtn.addEventListener('click', () => {
        let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
        let nombre = modalNombre.textContent;
        let precio = precioUnitario;
        let cantidad = parseInt(cantidadInput.value);
        let total = precio * cantidad;

        // Verificar si ya existe en carrito
        let index = carrito.findIndex(p => p.nombre === nombre);
        if(index >= 0){
            carrito[index].cantidad += cantidad;
            carrito[index].total += total;
        } else {
            carrito.push({nombre, precio, cantidad, total});
        }

        localStorage.setItem('carrito', JSON.stringify(carrito));
        alert(`Agregaste ${cantidad} x ${nombre} al carrito. Total: $${total.toFixed(2)}`);
        modal.style.display = 'none';
    });
    </script>
</body>
</html>
