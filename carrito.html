<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Carrito - Gustica</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
    <header>
        <div class="logo">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo">
        </div>
        <nav>
            <a href="{{ url_for('inicio') }}">Inicio</a>
            <a href="{{ url_for('quienes') }}">Quiénes Somos</a>
            <a href="{{ url_for('productos') }}">Productos</a>
            <a href="#contacto">Contacto</a>
        </nav>
    </header>

    <main class="carrito-section">
        <h2>Tu Carrito</h2>

        <div id="carrito-productos">
            <!-- Cada producto será insertado aquí con JavaScript -->
        </div>

        <div class="total-carrito">
            Total: $<span id="total-carrito">0.00</span>
        </div>

        <button id="enviar-whatsapp">Enviar Pedido por WhatsApp</button>
    </main>

    {% include 'footer.html' %}

    <script>
    let carrito = [
        {nombre: "Piña", precio: 2.5, cantidad: 2, imagen: "{{ url_for('static', filename='piña.jpg') }}"},
        {nombre: "Mango", precio: 3.0, cantidad: 1, imagen: "{{ url_for('static', filename='mango.jpg') }}"}
    ];

    const carritoDiv = document.getElementById('carrito-productos');
    const totalSpan = document.getElementById('total-carrito');

    function renderCarrito() {
        carritoDiv.innerHTML = '';
        let total = 0;
        carrito.forEach((prod, index) => {
            const prodDiv = document.createElement('div');
            prodDiv.className = 'producto-carrito';
            prodDiv.innerHTML = `
                <img src="${prod.imagen}" alt="${prod.nombre}">
                <div class="producto-info">
                    <h4>${prod.nombre}</h4>
                    <p>Precio: $${prod.precio.toFixed(2)}</p>
                </div>
                <div class="producto-cantidad">
                    <input type="number" value="${prod.cantidad}" min="1" data-index="${index}">
                    <span>$${(prod.precio * prod.cantidad).toFixed(2)}</span>
                </div>
            `;
            carritoDiv.appendChild(prodDiv);
            total += prod.precio * prod.cantidad;
        });
        totalSpan.textContent = total.toFixed(2);

        // actualizar cantidad
        document.querySelectorAll('.producto-cantidad input').forEach(input => {
            input.addEventListener('input', e => {
                const idx = e.target.dataset.index;
                carrito[idx].cantidad = parseInt(e.target.value) || 1;
                renderCarrito();
            });
        });
    }

    renderCarrito();

    // Botón WhatsApp
    document.getElementById('enviar-whatsapp').addEventListener('click', () => {
        let mensaje = 'Buenas, necesito:\n';
        let total = 0;
        carrito.forEach(prod => {
            mensaje += `- ${prod.cantidad} x ${prod.nombre} ($${(prod.precio*prod.cantidad).toFixed(2)})\n`;
            total += prod.precio*prod.cantidad;
        });
        mensaje += `Total: $${total.toFixed(2)}`;
        const url = `https://wa.me/50660021483?text=${encodeURIComponent(mensaje)}`;
        window.open(url, '_blank');
    });
    </script>
</body>
</html>
